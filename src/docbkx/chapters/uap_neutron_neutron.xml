<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE section [
        <!-- Some useful entities borrowed from HTML -->
        <!ENTITY ndash  "&#x2013;">
        <!ENTITY mdash  "&#x2014;">
        <!ENTITY hellip "&#x2026;">
        
        <!-- Useful for describing APIs -->
        <!ENTITY GET    '<command xmlns="http://docbook.org/ns/docbook">GET</command>'>
        <!ENTITY PUT    '<command xmlns="http://docbook.org/ns/docbook">PUT</command>'>
        <!ENTITY POST   '<command xmlns="http://docbook.org/ns/docbook">POST</command>'>
        <!ENTITY DELETE '<command xmlns="http://docbook.org/ns/docbook">DELETE</command>'>
]>
<section xml:id="uap_neutron_neutron" xmlns="http://docbook.org/ns/docbook" xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:raxm="http://docs.rackspace.com/api/metadata" version="5.0">
    <title>Use allocation pools to control dynamic IP address allocation with neutron client</title>
    <para>These sections walk you through using allocation pools to control dynamic IP address allocation by using the
        neutron client.</para>
    <sidebar>
        <para><emphasis role="bold">Start here: </emphasis>
            <link xlink:href="neutron_create_network_uap_neutron.html">Create a network (neutron client)</link></para>
    </sidebar>
    <section xml:id="neutron_create_network_uap_neutron">
        <title>Create a network (neutron client)</title>
        <para>After you create a network, copy its network ID. You use this ID to create a subnet and boot the server.</para>
        <procedure>
            <title>To create a network</title>
            <step>
                <para>Issue the following neutron client command, substituting your own values for the ones shown.</para>
                <para><emphasis role="bold">Positional argument:</emphasis></para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>The network name. In this example, the network name is <literal>Rackernet</literal>.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para><programlisting language="bash" role="gutter: false"><?db-font-size 75%?>
                        <prompt>$</prompt> neutron net-create &lt;Rackernet&gt;</programlisting></para>
                <para><emphasis role="bold">Output:</emphasis>
                </para>
                <para>The command returns the response, as shown in the following output:</para>
                <informalexample>
                    <screen><computeroutput><?db-font-size 75%?>
+----------------+--------------------------------------+
| Field          | Value                                |
+----------------+--------------------------------------+
| admin_state_up | True                                 |
| id             | a8fde776-e80f-47bb-a050-0c057d89afc3 |
| name           | Rackernet                            |
| shared         | False                                |
| status         | ACTIVE                               |
| subnets        |                                      |
| tenant_id      | 5831008                              |
+----------------+--------------------------------------+</computeroutput></screen>
                </informalexample>
            </step>
            <step>
                <para>Copy the <literal>id</literal> value from the output. You will use this value when you create a subnet,
                    provision your server, or perform other related activities. In this example, the ID is
                        <literal>a8fde776-e80f-47bb-a050-0c057d89afc3</literal>, but use the ID from your response.</para>
            </step>
        </procedure>
        <sidebar>
            <para><emphasis role="bold">Next step: </emphasis>
                <link xlink:href="neutron_create_subnet_uap_neutron.html">Create a subnet with allocation pools (neutron
                    client)</link></para>
        </sidebar>
    </section>

    <section xml:id="neutron_create_subnet_uap_neutron">
        <title>Create a subnet with allocation pools (neutron client)</title>
        <para>To create a subnet with allocation pools, you specify a network, an IP address and version, allocation pools,
            and host routes for your subnet.</para>
        <procedure>
            <title>To create a subnet with allocation pools</title>
            <step>
                <para>Issue the following neutron client command, substituting your own values for the ones shown.</para>
                <para><emphasis role="bold">Positional argument:</emphasis></para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><emphasis role="bold">ip-version</emphasis> The version of the subnet IP. In this example,
                                the version is <literal>4</literal>.</para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">allocation-pool</emphasis> The start and end addresses for one or
                                more allocation pools. In this example, there are two pools
                                    <literal>start=192.168.5.3,end=192.168.5.100</literal> and
                                    <literal>start=192.168.5.103,end=192.168.5.254</literal>.</para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">host-route</emphasis> A list of host route dictionaries for the
                                subnet. In this example, we used
                                    <literal>destination=1.1.1.0/24,nexthop=192.168.5.254</literal>.</para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">tenant-id</emphasis> The tenant ID. In this example, we used the
                                tenant ID <literal>5831008</literal>.</para>
                        </listitem>
                        <listitem>
                            <para>The network ID or name. In this example, we used the network ID
                                    <literal>a8fde776-e80f-47bb-a050-0c057d89afc3</literal>.</para>
                        </listitem>
                        <listitem>
                            <para>The network CIDR. In this example, the CIDR is <literal>192.168.5.0/24</literal>.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para><programlisting language="bash" role="gutter: false"><?db-font-size 75%?>
                        <prompt>$</prompt> neutron subnet-create \
    --ip-version &lt;4&gt; \
    --allocation-pool start=&lt;192.168.5.3&gt;,end=&lt;192.168.5.100&gt; \
    --allocation-pool start=&lt;192.168.5.103&gt;,end=&lt;192.168.5.254&gt; \
    --host-route destination=&lt;1.1.1.0/24&gt;,nexthop=&lt;192.168.5.254&gt; \
    --tenant-id &lt;5831008&gt; \
    &lt;a8fde776-e80f-47bb-a050-0c057d89afc3&gt; &lt;192.168.5.0/24&gt;</programlisting></para>
                <para><emphasis role="bold">Output:</emphasis>
                </para>
                <para>The command returns the response, as shown in the following output:</para>
                <informalexample>
                    <screen><computeroutput><?db-font-size 75%?>
+------------------+-----------------------------------------------------------+
| Field            | Value                                                     |
+------------------+-----------------------------------------------------------+
| allocation_pools | {"start": "192.168.5.3", "end": "192.168.5.100"}          |
|                  | {"start": "192.168.5.103", "end": "192.168.5.254"}        |
| cidr             | 192.168.5.0/24                                            |
| dns_nameservers  |                                                           |
| enable_dhcp      |                                                           |
| gateway_ip       |                                                           |
| host_routes      | {"destination": "1.1.1.0/24", "nexthop": "192.168.5.254"} |
| id               | 98c1af30-05c9-4502-8b1f-9bffde843cba                      |
| ip_version       | 4                                                         |
| name             |                                                           |
| network_id       | a8fde776-e80f-47bb-a050-0c057d89afc3                      |
| tenant_id        | 5831008                                                   |
+------------------+-----------------------------------------------------------+</computeroutput></screen>
                </informalexample>
            </step>
            <step>
                <para>Copy the ID value from the output for future reference. In this example, the ID is
                        <literal>98c1af30-05c9-4502-8b1f-9bffde843cba</literal>, but use the ID from your response.</para>
            </step>
        </procedure>
        <sidebar>
            <para><emphasis role="bold">Next step: </emphasis>
                <link xlink:href="neutron_boot_server_uap_nova.html">Boot server (nova client)</link></para>
        </sidebar>
    </section>

    <section xml:id="neutron_boot_server_uap_nova">
        <title>Boot server (nova client)</title>
        <para>The following step shows you how to boot server with the nova client, using the network ID of the network you
            created in the first step of this procedure. You need the following information:</para>
        <para>
            <itemizedlist>
                <listitem>
                    <para>The name of the new server. Use a name of your choice.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">image</emphasis> The image ID.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">flavor</emphasis> The flavor ID.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold">nic</emphasis>The network ID of the network, which is
                            <literal>net-id=a8fde776-e80f-47bb-a050-0c057d89afc3</literal>. </para>
                </listitem>
            </itemizedlist>
        </para>
        <procedure>
            <title>To provision a server with a network</title>
            <step>
                <para>Issue the following nova client command:
                    <programlisting language="bash" role="gutter: false"><?db-font-size 80%?>
<prompt>$</prompt> nova boot &lt;ata&gt; --image &lt;ffa476b1-9b14-46bd-99a8-862d1d94eb7a&gt; --flavor &lt;2&gt; --nic net-id=&lt;a8fde776-e80f-47bb-a050-0c057d89afc3&gt;</programlisting></para>

                <para>The operation returns information about the new server, as shown in the following example:</para>
                <para><informalexample>
                        <screen><computeroutput>
+-------------------------+-----------------------------------------------------------------+
| Property                | Value                                                           |
+-------------------------+-----------------------------------------------------------------+
| OS-DCF:diskConfig       | AUTO                                                            |
| OS-EXT-STS:power_state  | 0                                                               |
| OS-EXT-STS:task_state   | scheduling                                                      |
| OS-EXT-STS:vm_state     | building                                                        |
| accessIPv4              |                                                                 |
| accessIPv6              |                                                                 |
| adminPass               | ugZmn5Le6S8y                                                    |
| created                 | 2014-02-06T20:05:12Z                                            |
| flavor                  | m1.mid (2)                                                      |
| hostId                  |                                                                 |
| id                      | a1061a57-0136-4c29-aac1-8b1a646a3001                            |
| image                   | cirros-0.3.0-x86_64-disk (82e72de5-6366-4217-8c87-a570a9b17e73) |
| metadata                | {}                                                              |
| name                    | ata                                                             |
| progress                | 0                                                               |
| security_groups         | default                                                         |
| status                  | BUILD                                                           |
| tenant_id               | 5831008                                                         |
| updated                 | 2014-02-06T20:05:12Z                                            |
| user_id                 | 28be72f8fc5b45589c93f55274e459ce                                |
+-------------------------+-----------------------------------------------------------------+</computeroutput></screen>
                    </informalexample></para>
            </step>
            <step>
                <para>Copy the <literal>id</literal> value from the output for future reference. In this example, the ID is
                        <literal>a1061a57-0136-4c29-aac1-8b1a646a3001</literal>, but use the ID from your response.</para>
            </step>
        </procedure>
        <sidebar>
            <para>
                <emphasis role="bold">Next step:</emphasis>
                <link xlink:href="neutron_verify_ip_nova.html">Verify IP on server port (nova client)</link>
            </para>
        </sidebar>
    </section>

    <section xml:id="neutron_verify_ip_nova">
        <title>Verify IP on server port (nova client)</title>
        <para>The following step shows you how to verify the IP address on the server port. In this case, the IP address
            should be <literal>192.168.5.3</literal> from the start of the allocation pool.</para>
        <procedure>
            <title>To verify the port on the server</title>
            <step>
                <para>Issue the following nova command:
                    <programlisting language="bash" role="gutter: false"><?db-font-size 75%?>
<prompt>$</prompt> nova list &lt;a1061a57-0136-4c29-aac1-8b1a646a3001&gt;</programlisting></para>
                <para><emphasis role="bold">Positional arguments:</emphasis></para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para>The server ID. In this example, the ID is
                                    <literal>a1061a57-0136-4c29-aac1-8b1a646a3001</literal>.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para><emphasis role="bold">Output:</emphasis></para>
                <para>The command returns the response, as shown in the following output:</para>
                <informalexample>
                    <screen><computeroutput><?db-font-size 75%?>
+-------------------------+------------------------------------------------------------------------------------+
| Property                | Value                                                                              |
+-------------------------+------------------------------------------------------------------------------------+
| OS-DCF:diskConfig       | AUTO                                                                               |
| OS-EXT-STS:power_state  | 1                                                                                  |
| OS-EXT-STS:task_state   | None                                                                               |
| OS-EXT-STS:vm_state     | active                                                                             |
| accessIPv4              | 10.23.233.124                                                                      |
| accessIPv6              | 2001:4801:787f:205:bccb:feff:fe00:189                                              |
| created                 | 2012-08-16T16:28:18Z                                                               |
| flavor                  | 8GB Standard Instance (6)                                                          |
| hostId                  | 0488142a8f859cb4020234cc235f8cd8a22bee126726025d70c0b9ba                           |
| id                      | a1061a57-0136-4c29-aac1-8b1a646a3001                                               |
| image                   | cirros-0.3.0-x86_64-disk (82e72de5-6366-4217-8c87-a570a9b17e73)                    |
| metadata                | {}                                                                                 |
| name                    | ata                                                                                |
| Rackernet               | 192.168.5.3                                                                        |
| private network         | 10.181.192.114                                                                     |
| progress                | 100                                                                                |
| public network          | 2001:4801:787f:205:bccb:feff:fe00:189, 10.23.233.124                               |
| status                  | ACTIVE                                                                             |
| tenant_id               | 5831008                                                                            |
| updated                 | 2014-02-06T20:05:12Z                                                               |
| user_id                 | 28be72f8fc5b45589c93f55274e459ce                                                   |
+-------------------------+------------------------------------------------------------------------------------+</computeroutput></screen>
                </informalexample>
            </step>
            <step>
                <para>Copy the id value from the output. You will use this value when you provision your server. In this
                    example, the port id is <literal>e84fb78e-fc92-45aa-90b3-8786c82b5112</literal>.</para>
            </step>
        </procedure>

        <sidebar>
            <para><emphasis role="bold">Next step:</emphasis>
                <link xlink:href="neutron_create_port_uap_neutron.html">Create a port (neutron client)</link></para>
        </sidebar>
    </section>

    <section xml:id="neutron_create_port_uap_neutron">
        <title>Create a port outside the allocation pool (neutron client)</title>
        <para>Before you can attach port and network to a server, you need to create the port.</para>
        <para>The following step shows you create a port outside of the allocation pool using cURL. Do this by using the
            fixed_ips attribute and assigning the new IP address to the port. In this case, the allocation pool IP addresses
            range from <literal>192.168.5.3</literal> to <literal>192.168.5.100</literal> and the IP address for the new port
            is <literal>192.168.5.1</literal>.</para>
        <procedure>
            <title>To create a port</title>
            <step>
                <para>Issue the following neutron command.</para>
                <para><emphasis role="bold">Positional arguments:</emphasis></para>
                <para>
                    <itemizedlist>
                        <listitem>
                            <para><emphasis role="bold">name</emphasis> The port name. In this example, the port name is
                                    <literal>Rackerport</literal>.</para>
                        </listitem>
                        <listitem>
                            <para><emphasis role="bold">fixed-ip</emphasis> The subnet id and IP address. In this example,
                                the fixed IP is
                                    <literal>subnet_id=98c1af30-05c9-4502-8b1f-9bffde843cba,ip_address=192.168.5.1</literal>.</para>
                        </listitem>
                        <listitem>
                            <para>The network ID or name. In this example, the ID is
                                    <literal>a8fde776-e80f-47bb-a050-0c057d89afc3</literal>.</para>
                        </listitem>
                    </itemizedlist>
                </para>
                <para><programlisting language="bash" role="gutter: false"><?db-font-size 75%?>
<prompt>$</prompt> neutron port-create \
    --name &lt;Rackerport&gt; \
    --fixed-ip subnet_id=&lt;98c1af30-05c9-4502-8b1f-9bffde843cba&gt;,ip_address=&lt;192.168.5.1&gt; \
    &lt;a8fde776-e80f-47bb-a050-0c057d89afc3&gt;</programlisting></para>
                <para><emphasis role="bold">Output:</emphasis></para>
                <para>The command returns the response, as shown in the following output:</para>
                <informalexample>
                    <screen><computeroutput><?db-font-size 75%?>
+-----------------+------------------------------------------------------------------------------------+
| Field           | Value                                                                              |
+-----------------+------------------------------------------------------------------------------------+
| admin_state_up  | True                                                                               |
| device_id       |                                                                                    |
| device_owner    |                                                                                    |
| fixed_ips       | {"subnet_id": "98c1af30-05c9-4502-8b1f-9bffde843cba", "ip_address": "192.168.5.1"} |
| id              | e84fb78e-fc92-45aa-90b3-8786c82b5112                                               |
| mac_address     | BE:CB:FE:00:01:69                                                                  |
| name            | Rackerport                                                                         |
| network_id      | a8fde776-e80f-47bb-a050-0c057d89afc3                                               |
| security_groups |                                                                                    |
| status          | ACTIVE                                                                             |
| tenant_id       | 5831008                                                                            |
+-----------------+------------------------------------------------------------------------------------+</computeroutput></screen>
                </informalexample>
            </step>
        </procedure>

        <sidebar>
            <para><emphasis role="bold">Next topic: </emphasis>
                <link xlink:href="configure_host_routes.html">Configure host routes</link>
            </para>
        </sidebar>
    </section>
</section>
